from glob import glob

# Collect all section and appendix files so that any edit triggers a rebuild
sections   = sorted(glob("phase3/paper/sections/*.tex"))
appendices = sorted(glob("phase3/paper/appendix/*.tex"))

rule build_phase3_paper_pdf:
    input:
        ["phase3/paper/main.tex", "phase3/paper/Reference.bib"] + sections + appendices
    output:
        "phase3/outputs/paper/phase3_paper.pdf",
        "phase3/artifacts/origin-axiom-phase3.pdf"
    shell:
        r"""
        set -euo pipefail

        cd phase3/paper

        latexmk -pdf -interaction=nonstopmode -halt-on-error -file-line-error -recorder main.tex

        cp main.pdf ../outputs/paper/phase3_paper.pdf
        cp main.pdf ../artifacts/origin-axiom-phase3.pdf
        """

rule all:
    input:
        "phase3/outputs/paper/phase3_paper.pdf",
        "phase3/artifacts/origin-axiom-phase3.pdf"
