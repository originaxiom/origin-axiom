% Phase 4 diagnostics: vacuum map, toy corridors, and FRW-facing probes

The Phase~4 diagnostics are deliberately layered. The goal is to place
the F1 mapping family on a numerically solid footing and to expose a
sequence of increasingly structured, but still non-binding, probes
that later work can refine or replace. All layers are wired through
explicit on-disk artefacts in \texttt{phase4/outputs/tables/} so that
their behaviour can be inspected without touching the code.

We summarise the main layers here.

\medskip

\noindent\textbf{(1) F1 sanity curve.}
The first rung is a minimal ``vacuum curve'' sanity check. We reuse
the Phase~3 baseline mechanism diagnostics stored in
\texttt{phase3/outputs/tables/mech\_baseline\_scan\_diagnostics.json}
to define a quantile-based floor \(\epsfloor\) for the unconstrained
amplitude \(A(\theta)\). The F1 family then defines a scalar
\[
  E_{\mathrm{vac}}(\theta) \;=\; \alpha\,A(\theta)^{\beta}
\]
with fixed toy parameters \(\alpha = 1\) and \(\beta = 4\) in the
baseline configuration. The script
\texttt{phase4/src/phase4/run\_f1\_sanity.py} evaluates
\(E_{\mathrm{vac}}(\theta)\) on a uniform grid of
\(N_\theta = 2048\) points in \([0, 2\pi)\), writing a per-grid CSV
\begin{center}
  \texttt{phase4/outputs/tables/phase4\_F1\_sanity\_curve.csv},
\end{center}
together with a metadata block recording global minima, maxima,
quantiles, and the exact Phase~3 diagnostics that were reused. This
layer only checks that the F1 map is numerically sane (strictly
positive, small, and well-resolved) and cleanly wired to Phase~3; it
does not attempt any physical calibration.

\medskip

\noindent\textbf{(2) F1 shape diagnostics and a toy corridor.}
The second rung looks at the \emph{shape} of the F1 curve rather than
individual values. The script
\texttt{phase4/src/phase4/run\_f1\_shape\_diagnostics.py} consumes the
F1 sanity CSV and constructs a toy ``low-\(E_{\mathrm{vac}}\)''
corridor via a simple threshold
\[
  E_{\mathrm{vac}}(\theta)
  \;\leq\;
  E_{\mathrm{vac},\min} + k_\sigma\,\sigma,
\]
with a baseline choice \(k_\sigma = 1\). It produces

\begin{itemize}
  \item a JSON summary
    \texttt{phase4/outputs/tables/phase4\_F1\_shape\_diagnostics.json},
    recording amplitude statistics, the chosen threshold, and the
    resulting corridor fraction; and
  \item a per-grid mask
    \texttt{phase4/outputs/tables/phase4\_F1\_shape\_mask.csv},
    listing \(\theta\), \(E_{\mathrm{vac}}(\theta)\), and an indicator
    of membership in this toy corridor.
\end{itemize}

This is explicitly labelled as exploratory and non-binding. It shows
how a mechanically defined scalar can induce a corridor-like subset of
the \(\theta\)-grid, but it is \emph{not} used to define any Phase~4
\(\theta\)-filter or to suggest a preferred \(\theta_\star\).

\medskip

\noindent\textbf{(3) FRW-inspired toy sanity checks.}
The third rung embeds \(E_{\mathrm{vac}}(\theta)\) into a simple,
late-time FRW-inspired background. The script
\texttt{phase4/src/phase4/run\_f1\_frw\_toy\_diagnostics.py} rescales
the F1 vacuum curve into a toy dark-energy parameter
\(\Omega_\Lambda(\theta)\) with
\(\langle \Omega_\Lambda \rangle \approx 0.7\) at fixed
\(\Omega_m = 0.3\), \(\Omega_r = 0\). It then evaluates a schematic
FRW quantity
\[
  H^2(a; \theta)
  \;=\;
  \Omega_r a^{-4} + \Omega_m a^{-3} + \Omega_\Lambda(\theta)
\]
on a late-time scale-factor grid \(a \in [0.5, 1]\) and applies a
simple sanity criterion: \(H^2(a; \theta)\) must stay positive and
bounded in variation across that grid. This produces

\begin{itemize}
  \item a JSON diagnostics file
    \texttt{phase4/outputs/tables/phase4\_F1\_frw\_toy\_diagnostics.json},
    recording moments of \(E_{\mathrm{vac}}\),
    \(\Omega_\Lambda(\theta)\), the FRW parameters, and a
    ``FRW-sanity fraction''; and
  \item a per-grid mask
    \texttt{phase4/outputs/tables/phase4\_F1\_frw\_toy\_mask.csv}
    with \(\theta\), \(\Omega_\Lambda(\theta)\), and a Boolean
    indicator of FRW sanity.
\end{itemize}

This module is intentionally modest and strictly non-binding. It is
used as a structural probe of how the F1 scalar can feed into
FRW-like checks, and as an example of how empty-corridor outcomes
(when the sanity fraction is small or zero) are recorded and analysed
rather than hidden.

\medskip

\noindent\textbf{(4) FRW viability scan with age and era constraints.}
The fourth rung tightens the FRW-facing analysis into a more
cosmology-like viability scan, while still remaining at the level of a
toy model. The script
\texttt{phase4/src/phase4/run\_f1\_frw\_viability.py} again uses a
mapping from \(E_{\mathrm{vac}}(\theta)\) to \(\Omega_\Lambda(\theta)\)
with \(\langle \Omega_\Lambda \rangle \approx 0.7\) at fixed
\(\Omega_m = 0.3\), \(\Omega_r = 0\) and a toy Hubble parameter
\(H_0 = 70\,\mathrm{km\,s^{-1}\,Mpc^{-1}}\). For each grid point in
\(\theta\) it then

\begin{enumerate}
  \item computes a dimensionless FRW age integral
    \(t_0 H_0 = \int_0^1 \mathrm{d}a \big/ \left(a \sqrt{H^2(a;\theta)}\right)\)
    and converts it to a cosmic age \(t_0(\theta)\) in Gyr;
  \item checks for the existence of a ``matter era'' in which the
    \(\Omega_m a^{-3}\) term dominates over both radiation and
    \(\Omega_\Lambda(\theta)\) on part of the \(a\)-grid;
  \item checks for a ``late-time acceleration'' regime where the
    effective deceleration parameter becomes negative near \(a = 1\);
  \item requires a smooth, positive \(H^2(a; \theta)\) on the chosen
    grid; and
  \item demands that the resulting age lies in a broad window
    \(10\,\mathrm{Gyr} \le t_0(\theta) \le 20\,\mathrm{Gyr}\).
\end{enumerate}

The output is

\begin{itemize}
  \item a diagnostics file
    \texttt{phase4/outputs/tables/phase4\_F1\_frw\_viability\_diagnostics.json}
    summarising the distribution of ages and the fractions of grid
    points satisfying each individual condition and the combined
    viability cut; and
  \item a per-\(\theta\) mask
    \texttt{phase4/outputs/tables/phase4\_F1\_frw\_viability\_mask.csv}
    with columns
    \texttt{theta}, \texttt{E\_vac}, \texttt{omega\_lambda},
    \texttt{age\_Gyr}, individual Boolean flags
    (\texttt{has\_matter\_era}, \texttt{has\_late\_accel},
    \texttt{smooth\_H2}), and a combined
    \texttt{frw\_viable} flag.
\end{itemize}

At the baseline settings used here, a non-trivial fraction of the grid
(\(\approx 0.5\)) satisfies all of these toy viability criteria. The
exact numbers are not tuned to any observational data; they are
treated as diagnostics of how the F1 mapping behaves under a
cosmology-flavoured set of constraints.

\medskip

\noindent\textbf{(5) Corridor extraction from the FRW viability mask.}
The final rung in the current Phase~4 diagnostics compresses the FRW
viability mask into contiguous ``corridors'' in \(\theta\)-space. The
script
\texttt{phase4/src/phase4/run\_f1\_frw\_corridors.py} reads
\texttt{phase4\_F1\_frw\_viability\_mask.csv}, interprets the
\texttt{frw\_viable} flag as a Boolean viability indicator, and groups
successive viable grid points into connected components, allowing for
a small tolerance on the grid spacing. For each corridor it records

\begin{itemize}
  \item \(\theta_{\min}\), \(\theta_{\max}\);
  \item the number of included grid points; and
  \item an optional mean \(\langle \Omega_\Lambda \rangle\) over that
    corridor when the corresponding column is present.
\end{itemize}

The resulting corridors are written to

\begin{center}
  \texttt{phase4/outputs/tables/phase4\_F1\_frw\_corridors.json}, \\
  \texttt{phase4/outputs/tables/phase4\_F1\_frw\_corridors.csv}.
\end{center}

The JSON file additionally highlights a \emph{principal corridor}
(selected as the one with the largest number of grid points) together
with basic metadata such as the total grid size, the overall viable
fraction, and the total number of corridors.

Even at this rung the construction remains explicitly non-binding:
the corridors are treated as candidate bands emerging from a
cosmology-flavoured viability scan, not as a canonical
Phase~4 \(\theta\)-filter or a claimed prediction of a preferred
\(\theta_\star\). Their role is to show, in a fully reproducible way,
how the Phase~3 mechanism, the F1 mapping, and simple FRW-inspired
constraints can be chained into corridor-like structures that later,
more physically ambitious work can interrogate or replace.

\subsubsection*{FRW \texorpdfstring{$\Lambda$}{$\Lambda$}CDM-like probe}

As a final FRW-facing diagnostic we place a broad
``$\Lambda$CDM-like'' window on top of the viability mask from the
previous rung. Concretely, we take the per-grid FRW-viable rows from
\texttt{phase4/outputs/tables/phase4\_F1\_frw\_viability\_mask.csv}
and require, in addition:
\begin{itemize}
  \item a vacuum fraction \(\Omega_\Lambda(\theta)\) within a toy
    tolerance window around a target \(\Omega_\Lambda^{\mathrm{target}}
    \approx 0.7\); and
  \item a cosmological age in a toy window around
    \(t_0^{\mathrm{target}} \approx 13.8\,\mathrm{Gyr}\), using the
    same FRW toy model as the viability rung
    (\(\Omega_m = 0.3\), \(\Omega_r = 0\), \(H_0 = 70\,\mathrm{km\,s^{-1}\,Mpc^{-1}}\)).
\end{itemize}

The script
\texttt{phase4/src/phase4/run\_f1\_frw\_lcdm\_probe.py} implements
this probe, reading the FRW-viability mask and writing:
\begin{itemize}
  \item a JSON summary
    \texttt{phase4/outputs/tables/phase4\_F1\_frw\_lcdm\_probe.json},
    which records the target windows, the \(\theta\)-extent of the
    \(\Lambda\)CDM-like subset, and the corresponding grid fraction;
  \item a per-grid mask
    \texttt{phase4/outputs/tables/phase4\_F1\_frw\_lcdm\_probe\_mask.csv},
    which augments the FRW-viability columns with a Boolean
    \texttt{lcdm\_like} flag.
\end{itemize}

In the current baseline configuration, this $\Lambda$CDM-like window selects a
small but non-zero subset of the FRW-viable \(\theta\)-grid points.
We stress that this remains a toy-level probe: it is not a fit to
observational data and does not fix a preferred \(\theta_\star\).
Instead, it serves to demonstrate that the Phase~3~\(\to\)~Phase~4
pipeline admits FRW histories that are, at least in a broad sense,
compatible with late-time \(\Lambda\)CDM-like cosmology.

Finally, we introduce a joined F1/FRW ``shape probe'' that ties
together the toy F1 shape corridor, the FRW-viability scan, and the
\(\Lambda\)CDM-like FRW probe on a common \(\theta\)-grid. The script
\texttt{phase4/src/phase4/run\_f1\_frw\_shape\_probe.py} reads

\begin{itemize}
  \item the toy F1 shape mask
    \texttt{phase4/outputs/tables/phase4\_F1\_shape\_mask.csv}
    (columns \texttt{theta}, \texttt{E\_vac},
    \texttt{in\_toy\_corridor});
  \item the FRW-viability mask
    \texttt{phase4/outputs/tables/phase4\_F1\_frw\_viability\_mask.csv}
    (columns \texttt{theta}, \texttt{E\_vac}, \texttt{omega\_lambda},
    \texttt{age\_Gyr} and the Boolean flags
    \texttt{has\_matter\_era}, \texttt{has\_late\_accel},
    \texttt{smooth\_H2}, \texttt{frw\_viable});
  \item the \(\Lambda\)CDM-like FRW probe mask
    \texttt{phase4/outputs/tables/phase4\_F1\_frw\_lcdm\_probe\_mask.csv},
    which adds a \texttt{lcdm\_like} flag on top of the
    FRW-viability columns.
\end{itemize}

It joins these by the \(\theta\)-grid and writes

\begin{itemize}
  \item a joined per-\(\theta\) mask
    \texttt{phase4/outputs/tables/phase4\_F1\_frw\_shape\_probe\_mask.csv}
    with columns
    \texttt{theta}, \texttt{E\_vac}, \texttt{omega\_lambda},
    \texttt{age\_Gyr}, \texttt{in\_toy\_corridor}, \texttt{frw\_viable},
    \texttt{lcdm\_like}, and the composite flags
    \texttt{shape\_and\_viable},
    \texttt{shape\_and\_lcdm}; and
  \item a JSON diagnostics summary
    \texttt{phase4/outputs/tables/phase4\_F1\_frw\_shape\_probe.json}
    recording the corresponding fractions and \(\theta\)-ranges.
\end{itemize}

In the current baseline configuration this reveals a small but
non-zero overlap region where the toy F1 corridor, FRW-viable
histories, and the \(\Lambda\)CDM-like windows coexist. As with the
other FRW-facing diagnostics, this \emph{remains non-binding}: it does
not fix a unique \(\theta_\star\) and is used to make the
Phase~3-to-Phase~4 interface auditable rather than to claim a physical
fit to cosmological data.

To give a compact view of these overlaps, we also generate a
summary plot using
\texttt{phase4/src/phase4/plot\_f1\_frw\_shape\_probe.py}, which reads
the joined mask and produces a \(\theta\)â€“\(\Omega_\Lambda(\theta)\)
scatter. Figure~\ref{fig:phase4_f1_frw_shape_probe} shows all grid
points, the FRW-viable subset, the \(\Lambda\)CDM-like subset, and
the intersection where the toy F1 corridor and the \(\Lambda\)CDM-like
conditions coincide.

\begin{figure}[t]
  \centering
  \includegraphics[width=0.9\linewidth]{../outputs/figures/phase4_F1_frw_shape_probe_omega_lambda_vs_theta}
  \caption{Phase~4 F1/FRW shape probe: toy F1 corridor, FRW-viable
    histories, and \(\Lambda\)CDM-like points on the common
    \(\theta\)-grid. The plot is generated from the joined mask
    \texttt{phase4\_F1\_frw\_shape\_probe\_mask.csv}.}
  \label{fig:phase4_f1_frw_shape_probe}
\end{figure}
